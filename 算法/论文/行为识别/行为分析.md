# 第一章 基于深度学习的人体行为识别方法综述

## 1.1 基于手工特征的方法

基于手工特征的人体行为识别流程如下图所示：

![](https://gitee.com/weifagan/MyPic/raw/master/img/action_analyse.PNG)

基于手工特征的人体行为识别方法分类：

* 轮廓剪影
  * 早期的工作将视频帧看做整体，提取全局特征。通常采用背景剪除法、人体轮廓剪影、查分法等检测人体行为区域。
* 人体关节点
* 时空兴趣点
  * 通过探测算子检测出视频的时空兴趣点，然后从兴趣点周围提取行为特征。
* 运动轨迹
  * 通过追踪人体动作的运行轨迹提取行为特征。

## 1.2 基于深度学习方法

基于深度学习方法的人体识别方法流程如下图所示：

![](https://gitee.com/weifagan/MyPic/raw/master/img/action_analyse1.PNG)

* 双流网络

  * 流程图

  ![](https://gitee.com/weifagan/MyPic/raw/master/img/action_analyse2.PNG)

* 3D卷积网络

  * 对视频沿着空间和时间维度直接提取时空特征

* 受限玻尔兹曼机

  * 可通过输入数据集学习概率分布的生成网络模型

* 循环神经网络

  * 对时间序列进行建模

## 1.3 人体行为识别数据集

![](https://gitee.com/weifagan/MyPic/raw/master/img/aa_data.PNG)

## 1.4 挑战

* 受到GPU和CPU等硬件的限制，不能将整个视频直接输入网络模型中提取特征，只能利用连续帧间的信息冗余性从视频中提取部分帧来代替整个视频，耳聪提取深度特征
* 视频数据量巨大，有效标注的人力和时间是巨大的
* 基于深度学习的人体行为识别方法的网络模型计算复杂且速度慢，难以达到产业要求。

# 第二章 Temporal Sliding LSTM networks
## 2.1 摘要

文章解决了行为识别的骨骼关节点的**特征表达和时间动态的建模**问题。传统的方法基于一些关节点使用相对坐标系统，仅仅使用**长期依赖**来建模，但是**缺少短期和中期的依赖**。作者不用未处理的骨骼节点作为输入，而是把骨骼关节点转换到另外一个坐标系统来得到尺度选择和平移的鲁棒性，然后从它们中提取显著的运动特征。考虑到有各种时间步长大小的LSTM也可以对各种属性建模。所提的网络分别由**短时，中时和长时网络**组成。作者使用对多部分使用平均集成作为最后特征来捕获各种时期的依赖。

## 2.2 介绍

* 传统的方法使用单眼RGB视频序列，这很难捕获人体行为的3D空间
* 人体可以由线段连接关节点的人体骨骼图所表达，关节的运动提供了估计识别的关键
* 基于骨骼节点的行为识别有两个相关问题
  * 输入数据(尺度旋转平移)变化问题
  * 人体行为的建模是变化的，动态和彼此相似的

* 很多基于骨骼点的方法使用相对坐标，这样子忽略了骨骼点绝对坐标的运动
* 很多LSTM模型只是对总体时间动态建模，没有考虑详细的时间动态

* 提出了集成的时间华东LSTM，集成了各种行为属性的平均结合。

  * 首先对输入的骨骼序列坐标进行转换成对尺度，旋转和平移鲁棒的。
  * 利用时间差的运动特征，帮助网络集中于实际的骨骼运动
  * 运动特征被多时期的LSTM所处理，包括短期中期和长期的.这样对各种时期动态鲁棒

  * 多时期的LSTM通过集成来捕获各种行为动态

## 2.3 系统模型

### 2.3.1 特征提取

尽管图中的骨骼关节的有相同的行为类别，但是由于方向未匹配，骨骼节点有不同的属性(如下图)。为了解决这个问题，作者把原始坐标转换为人体认知坐标，这样子有方向的一致性。

![](https://gitee.com/weifagan/MyPic/raw/master/img/TS_LSTM9.PNG)

坐标转换计算过程如下：

![](https://gitee.com/weifagan/MyPic/raw/master/img/TS_LSTM1.PNG)

其中

![](https://gitee.com/weifagan/MyPic/raw/master/img/TS_LSTM2.PNG)

$S_t^i$表示第$t$帧的第$i$个骨骼节点坐标

$V_1$和$V_2$分别代表垂直于地面的向量和每个序列的初始骨骼点的左右髋关节的向量叉。

$Proj_{V1}(V2),V1\times V2$分别代表$V_2$在$V_1$的投影，$V1\times V_2$代表它们间的叉乘(叉乘的几何意义是垂直于V1V2平面的向量)

$S_{t=0}^{H_L}$ 和$S_{t=0}^{H_L}$ 表示每个序列的左右髋关节的初始坐标

不理解这个转换...

作者使用的运动特征作为框架的输入(个人理解应该就是转换坐标后再作特征提取作为输入)

那么第$t$帧的坐标表示为：

![](https://gitee.com/weifagan/MyPic/raw/master/img/TS_LSTM3.PNG)

运动特征计算：

![](https://gitee.com/weifagan/MyPic/raw/master/img/TS_LSTM4.PNG)

$D$是一个时间差补偿，通过$D$运行特征可以成为各种形式和除以$D+1$进行归一化。

我们可以利用转换的骨骼坐标和运动特征作为输入特征，它们被缩放为厘米单位，这使我们的模型表现良好。

**特征提取的过程总结一下**：

* 使用公式(1)对原始的坐标进行转换(这可以利用绝对坐标的信息)
* 连接骨骼关键点的坐标得的某一帧的坐标。
* 通过公式(5)计算运动特征
* 转换后的骨骼坐标和运动特征作为后期的输入特征

### 2.3.2 TS-LSTM

第$l^{th}$个TS_LSTM模块如下图：

![](https://gitee.com/weifagan/MyPic/raw/master/img/TS_LSTM5.PNG)

其中，$N_l$表示为LSTM网络数量，$W_l$表示LSTM窗口大小，$TS_l$表示时间步长。这种网络对于识别有时间动态变量的行为很有用，意思就是说需要识别可变的序列长度的行为，我们只需要调整窗口大小和时间步长。(什么是可变的序列长度？？)

第$l$的TS_LSTM的第$n$个LSTM的第$t$帧的记忆细胞、三个门和输出：

![](https://gitee.com/weifagan/MyPic/raw/master/img/TS_LSTM6.PNG)

发现这里比普通的LSTM多了一个$c_{t-1}$...

**思考一下**

* 话说这种有步长的网络对于识别可变序列长度的行为很有用，这是为什么呢？什么是可变序列长度行为？

**总结一下**

* 一个TS_LSTM模块有多层的LSTM网络组成，层与层之间具有时间步长，每一层也多个LSTM网络。

### 2.3.3 提出的网络框架

所提的网络框架如下图所示：

![](https://gitee.com/weifagan/MyPic/raw/master/img/TS_LSTM7.PNG)

训练时候有crosss-entropy 层，测试时候，使用各种softmax平均集成输出作为最后的输出。

为了找到所有样本的最大似然，使用两个cross-entropy函数到两个目标函数，训练时候，分别最小化这两个目标函数

![](https://gitee.com/weifagan/MyPic/raw/master/img/TS_LSTM8.PNG)

**思考一下**：

* 为什么这个能够得到短期中期长期的信息？
  * 除了集成阶段，各个网络是没有交互的，把不同时期的序列的图片送到对应时期的TS_LSTM网络。不同的网络负责不同时期的图片

## 2.4 总结讨论

* 作者尝试解决什么问题：
  * 特征表达
  * 时间动态建模
* 算法的关键思路是什么：
  * 先把原始坐标转换为对尺度旋转平移鲁棒的人体认知坐标，提取运动特征
  * 把运动特征送入多时期的网络，这对时间动态鲁棒
* 有什么值得为我所用：
  * 坐标的转换思路
  * 多时期网络思路
* 有哪些地方可能可改进：
  * 测试的集成方法不用平均，可以考虑其他的

# 第三章 Fusing Geometric Features for Skeleton-Based Action Recognition using Multilayer LSTM Networks(FGF_LSTM)

## 3.1 摘要

首先，提供了垂直RNN模型增强的简单通用的空间模型，特别地，选择一系列的样本几何特征并且把每一种特征分别地“喂入”3层的LSTM网络。其次，提出具有平滑得分融合技术的多流LSTM网络并从不同的几何特征来学习分类。Furthermore, 发现基于点线距离的几何特征效果最好。

## 3.2 介绍

* 行为识别的输入一般分成三种：RGB，深度和骨骼关节点
* 骨骼关节点的输入有以下优势
  * 骨骼点对于视觉点和外表是不变，相对RGB和深度具有更小的类内变量
  * 只有骨骼关节点是描述人体运动的高层次的信息
  * 基于骨骼关节点特征是最准确的
* 考虑到LSTM合适对依赖时间域建模，作者主要输入LSTM丰富的空间域特征(关节点间几何关系)

* 作者列举了八种几何特征来描述所有关节点间的关系(基于单帧或一个短帧)，发现点线距离的几何特征效果最好

* 所提方法有三大优势

  * 在所有的估计中，简单的几何特征比关节点坐标效果要好
  * 作者使用标准的LSTM模型就能得到先进的性能，这表明作者的发现合适于RNN模型的垂直开发

  * 描述节点的点线面的几何特征容易理解

* 多特征流的融合能够提升分类效果

* 作者连接了两个LSTM网络，这网络在训练期间在不同的层使用不同的几何特征，也对平均得分融合的性能，发现训练期间的融合不如基于骨骼的行为识别，但是平均得分融合比单一网络表现更好。

* 作者提出新的得分融合策略，首先每流的分布使用超参数平滑，然后每流的权重从一个联合框架中学习，

* 文章的贡献

  * 介绍了完整的系统，该系统结合了几何特征和堆叠的LSTM模型，证明所提出的$JLd$需要很少的训练样本，相比于关节点坐标
  * 提出的得分融合方法来有效地融合单个网络输出，该方法是首先平滑置信度得分然后自动地学习单个网络流的权重
  * 所提模型比很多well-design LSTM 网络更简单，但是能表现SOTA

## 3.3 相关工作

* 几何特征：作者通过DL扩展几何特征到行为识别
* 基于骨骼的RNN行为识别：相比于用well-designed LSTM网络学习特征，作者表明恰当地定义手动特征，也很super.
* 基于RGB方法融合：

## 3.4 Approach

**B 几何特征的空间模型**:

骨骼关节点之间可以组成很多的点线面，为了减少开销，作者对点线面进行有条件的选择。作者列举了八种独立于时间的几何特征来对姿态编码。

**C 通过平滑得分融合整和模型**:

![](https://gitee.com/weifagan/MyPic/raw/master/img/FGFM_LSTM.PNG)

**C1 实验发现**：

作者实验了三种融合策略，第一，输入融合的策略是最差的，原因可能是LSTM从不同的类型和没那么判别力的特征中来区分有用信息的能力比较弱。第二，全连接融合几乎和单流的网络一样，单网络的过拟合导致低识别率，两个过拟合网络产生非常低的loss，添加额外的全连接层并没有改变总体性能。第三，softmax的平均融合性能较好，这也是合理的因为这个方法不需要一个训练过程和避免过拟合(怎样就不需要一个训练过程和过拟合了)。

**C2 平滑得分融合**：

作者研究发现不同的特征对不同的类别的性能影响不同，某个特征对于某个类别的分类情况很好，但是对其他类别不一定好。所以不同的特征对于最后的预测贡献是不同，它们的权重也应该不同。但是总体上$JLd$特征的效果是最好的。

所以作者对于不同的特征分别了不同权重，然后把不同的权重分配到相应的特征softmax中，然后计算综合得分，计算如下，但是文章没有提到如何获得权重啊。。

![](https://gitee.com/weifagan/MyPic/raw/master/img/FGFM_LSTM2.PNG)

有了综合得分之后，就可以计算Loss了：

![](https://gitee.com/weifagan/MyPic/raw/master/img/FGFM_LSTM3.PNG)

**所提网络框架如下**：

![](https://gitee.com/weifagan/MyPic/raw/master/img/FGFM_LSTM1.PNG)



* **总结一下**：
  * 作者通过实验比对，发现softmax平均得分融合更好，在此基础上寻找更好的得分方法，就是所谓的平滑得分融合，计算过程见公式(5)(6)。
  * 关于网络结构，不同的特征输入到自己对应的LSTM网络中，然后计算综合得分。

**D 执行细节**：

* 所有关节点的坐标从相机坐标转换为人体坐标系统
* 基于骨骼链距离的总和对 3D点进行归一化，因为距离角度这样的特征对于坐标系统hi不变的。所以为了减少坐标变换带来的偏差，它们在相机坐标体统便计算出来
* 学习率，momentum。。。

## 3.5 实验结果

**B 数据集相关参数**：

* 数据集间特征维度不同，因为节点数量不同
* 平滑滤波器：很多论文中使用滤波器来平滑坐标数据，但这论文中没有使用
* 序列降采样：不同的数据集，降采样率不同
* 隐藏层：LSTM的神经元舒朗基于对结果没什么影响，只要跟输入特征维度保持正比即可。

**D 讨论**：

* 关节点选择：更多变化的关节点，识别性能更好
* 数据样本大小分析：使用$JLd$特征，训练时候需要更少样本
* 过拟合问题：$JJd,JLd,LLa$这些过拟合的特征和$Jc$特征相比，这些几何特征性能更好。
* 得分融合：作者发现高权重大多数来自表现好的流，权重的幅值仅仅依赖于每个迭代的更新和改变值的数量，NTU-RGB+D数据集有大量的样本和低识别率，每个迭代权重大大地更新很多次，所以NTU-RGB+D中，权重较大

## 3.6 结论

* 点线特征比其他特征更好
* 探究了几个融合方法，发现训练时候流之间的交互会得到更差的效果
* 提出新的得分融合
* 使用点线距离子集可以得到比较好的效果，并且使用点线子集只需要更小的样本

## 3.7 个人总结

* 论文解决什么问题
  * 为了解决行为识别的精准度问题
* 算法关键元素是什么
  * 作者用八种不同的几何特征输入到多流LSTM网络
  * 融合得分策略
* 为我所用
  * 获得几何特征的方法
  * 多特征流的融合可以提升性能
  * 得分融合方法
* 几何特征和上一篇运动特征哪个会更好的呢？

# 第四章 GCA_LSTM

## 4.1 摘要

并不是所有关节点都对行为分析有用，并且不相关的关节点会带来很多噪声。可是LSTM并没有强大的关注机制，所以作者提出在全局上下文信息的帮助下有能力选择信息丰富关节点的GCA_LSTM。为了得到行为序列可靠的关注表达，作者进一步提出反复关注机制的GCA_LSTM网络，这样子关注性能通过迭代能得到提升。

## 4.2 介绍

* 人体行为可以用3D空间的骨骼关节点所表达，但是并不意味着所有的关节点对于行为分析都是有用的。
* 在每帧中，选择性地关注信息丰富的关节点，并忽略不相关的特征，因为后者对行为识别贡献很少，并带来噪声。
* LSTM对3D行为识别没有强大的关注能力，这主要是因为对全局感知上下文信息的感知能力有限，但是这能力对于全局分类问题很重要
* 为了得到对关节点的可靠关注，我们需要对每帧的每个节点的全局行为序列衡量一个信息得分，这意味着我们首先需要有全局上下文知识，可是，LSTM每一步的可用的上下文都是相当局部的。
* 在所提的GCA_LSTM网络中，全局上下文信息会喂入到网络的每一步，所以网络可以利用它来衡量所有步骤新输入的信息得分和调整关注权重，
* 所提的GCA_LSTM网络包含两层，第一层是对骨骼序列进行编码并产生初始全局上下文记忆。然后这个全局上下文喂入到第二层的LSTM网络，帮助网络选择性地关注每帧中信息丰富的节点，并进一步对全局行为产生关注表达。然后这个关注表达被喂入到全局上下文记忆中并对它进行细致的处理。当然这个细致处理后的全局上下文集中可以再次喂入第二层来得到更可靠的关注表达，多个关注迭代可以逐步地执行来细致地处理全局上下文记忆。最后细致的全局上下文被喂入分类来预测行为。
* 文章贡献如下：
  * 所提出的GCA_LSTM保留了LSTM对序列的建模能力，也提升了选择机制能力。
  * 所提的反复关注机制可以逐步改善网络的关注性能。
  * 可视化结果表明，在行为序列每帧中，信息丰富的关节点可以在全局上下文信息的帮助下被可靠地辨别。

![](https://gitee.com/weifagan/MyPic/raw/master/img/GCA_LSTM.PNG)

## 4.4 相关工作

**关注机制**:作者的方法与前面介绍的方法不一样，它们都是使用LSTM的上一个时间步的状态来给下一个时间步提供关注得分，这使得上下文信息十分局部。对于行为识别这样子的全局分类问题，要可靠地评估每个输入的重要性来得到可靠的关注，这是需要全局信息的。所以提出全局上下文记忆的LSTM来评估每个输入的信息得分。

## 4.5 GCA_LSTM 

### 4.5.1 ST_LSTM

不同帧之间的同一个关节点的时间依赖和同一帧中不同关节点的空间依赖对基于关节点的行为分析都很重要。所提的2DST_LSTM网络同时对时间和空间领域的依赖和上下文信息进行建模。

空间方向和时间方向的信息作为ST_LSTM的输入，如下图：

![](https://gitee.com/weifagan/MyPic/raw/master/img/ST_LSTM.PNG)

ST_LSTM配有一个输入门，对应于时间和空间上下文信息的两个忘记门。

ST_LSTM网络的表达：

![](https://gitee.com/weifagan/MyPic/raw/master/img/ST_LSTM1.PNG)

### 4.5.2 全局上下文感知关注LSTM

一个行为可以由骨骼节点的运动的组合所表达。为了