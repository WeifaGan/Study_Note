# 1 操作系统概述

## 1.1 什么是操作系统

### 1.1.1 定义

对于操作系统，其实没有一个精准的定义，但是可以从功能和特点上描述。

* **它是一个控制软件。** 
  * 它控制着不同的软件运行
  * 控制不同软件之间的资源分配。
  * 为应用程序提供服务。包括了IO服务等，例如声卡网卡的访问。这方便了用户使用，不然只用一些硬件，用户咋用？
* **资源管理器**
  * 计算机有CPU、内存、外设等资源，这些资源如何分配给应用程序？操作系统可以确保不同的程序访问不同的资源，提高资源利用率。在计算机内部，CPU抽象成进程，磁盘抽象成文件，内存抽象成地址空间给应用程序使用。
* 操作系统层次结构
  * 硬件之上，应用程序之下。操作系统把硬件资源统一管理，给应用程序提供接口，这样子应用程序就可以方便地访问硬件资源了。

### 1.1.2 操作系统的两个接口

* 面向应用程序(外部)的shell。如linux、window的界面，linux的shell。如下图
* 面向计算机资源(内部)的kernel。kernel是我们研究重点。

![](https://gitee.com/weifagan/MyPic/raw/master/img/os.png)

### 1.1.3 Kernel-操作系统内部组件

* 关于CPU，CPU调度器
* 关于内存，有物理内存管理，虚拟内存管理
* 关于磁盘，文件系统管理，磁盘以文件的形式给应用程序访问。
* 跟底层相关，中断处理和设备驱动

### 1.1.4 操作系统kernel的特征

* 并发
  * 计算机系统可以同事运行多个程序，需要OS管理和调度
  * 注意并发和并行。并发是指一段时间内运行多个程序。并行是指一个时间点有运行多个程序，如果计算机是单核，则无法完成并行。
* 共享，应用程序共享CPU内存等硬件资源。
  * (看上去)“同时”共享，
  * (实际上)互斥共享，同一个时刻只有一个应用程序一个资源。
* 虚拟
  * CPU虚拟化成进程，磁盘虚拟化成文件，内存虚拟化成地址空间
  * 虚拟化是的让用户觉得只有自己在使用一台计算机(多道程序设计技术)
* 异步
  * 程序的运行不是一贯到底的，而是走走停停，而且向前推荐的速度不可预知。
  * 但是只要运行环境系统，应用程序运行的结果是相同的。

# 2 启动中断异常和系统调用

## 2.1 启动

先来认识这两个概念：

* bootloader：它放在磁盘的第一个主引导扇区，占512个字节，主要负责对放在磁盘中的系统加载到内存。

* bios：基本IO处理系统，放在内存RAM中。

CPU加电之后是如何加载系统的？系统的加载需要bios(基本IO处理系统)的支持，加电之后bios会对系统外设进行自检，如果自检没问题，会将bootloader放入内存，OS的加载由bootloader完成，bootloader会把OS的数据和代码加载到内存，之后就会把控制权交给OS了。

## 2.2 中断异常系统调用

**当OS被加载到内存后，它是如何与外设和应用系统交互的？**

对于外设的交互，需要通过中断、IO来完成。而与应用程序的交互需要通过系统调用和异常来完成的。

先来来看看概念：

* 系统调用(源于应用程序)：应用程序主动向操作系统发出服务请求
* 异常(源于不良应用程序)：非法指令或者其他坏的处理状态，如内存出错
* 中断(源于外设)：来自于不同硬件设备的计时器和网络中断



**为什么不能让应用程序直接对外设进行访问？**

因为有些应用程序是恶意的，不值得信任，而我们认为操作系统内核是值得信任。



